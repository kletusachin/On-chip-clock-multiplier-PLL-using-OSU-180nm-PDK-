# **On-chip-clock-multiplier-PLL-using-OSU-180nm-PDK**
![Screenshot (3375)](https://user-images.githubusercontent.com/46894129/137955077-4b7e1e04-a110-402b-a242-b1411c490cb1.png)


  - Introduction                                                  
  - Theory and fundamental concepts
  - Prelayout Implementation & simulation
  - Physical Design(PD) introduction
  - PFD and VCO PD
  - Frequency Divider and MUX PD
  - Final PLL layout and Conclusion
  - Applications learned
  - Author
  - Acknowledgements

## INTRODUCTION
The PLL plays a crucial role in most of the integrated circuits, processor or microcontroller.
The circuit functions to provide a required clock with fixed frequency and phase to the digital
blocks. It delivers the output frequency that is produced as a result of phase comparison at the
input with respect to the reference frequency. Cornucopia of research is carried out on
designing and improving the PLL, the emphasis on the improvement with respect to high
frequency precision and quick locking has been evident among the academia. The design of
PLL largely depends on accuracy in phase and frequency-locking with respect to reference
generated by crystal oscillator with less jitters. The design includes Phase and frequency
detector(PFD), charge pump, voltage controlled oscillator(VCO) and frequency
divider(FD). Fig.1.1 shows the basic block diagram if PLL.
<br />
![Screenshot (3367)](https://user-images.githubusercontent.com/46894129/137918766-5998746e-355d-4b7c-b8ed-8718bde42a10.png)
<p align="center">
    Fig.1.1. Basic block diagram
</p>                                                      
  
## THEORY AND FUNDAMENTAL CONCEPTS
### 1. Theory on CMOS implementation transistor sizing and system feedback loop
Phase lock loop is a feedback system that generates the signal whose frequency is proportional
to the frequency of the input signal, frequency divider in feedback loop is essentially to obtain
the multiplied frequency as an output of the PLL.
For PLL design, there is a requirement of a circuit that measures the difference between the two
phases, which is achieved by a phase detector. This block compares the input signal phase with
that of the output, by using simple exclusive OR(XOR) gate. XOR gate generates the pulse
whose width that varies with the phase difference between the two signals as in Fig.2.1.

![Screenshot (3371)](https://user-images.githubusercontent.com/46894129/137937756-d3895db4-599e-4d3a-b93a-eb1e3a8b7979.png)
<p align="center">
    Fig.2.1. Basics for PLL understanding 
</p>  


In addition to the basic PLL, a charge-pump based PLL uses a charge pump between the phase detector(PFD) and
loop filter. The output of the PFD is fed to the charge pump to obtain a continuous current at
the output. The charge-pump functions as an electronic switch that is controlled by the states
of PFD. The two outputs generated by the PFD are taken as input to the charge pump, based
on the values of the input given the switches of the charge pump turn on and off accordingly.
Thus always keeping either of the switches on but never on simultaneously switch 1 charges the
capacitor and 2 discharges so voltage change across capacitor determine the phase difference
generated which is shown in Fig.2.2.
 
  ![Screenshot (3372)](https://user-images.githubusercontent.com/46894129/137937870-94b19b37-4578-4d87-ac24-e11e637c2e4d.png)
<p align="center">
    Fig.2.2. Basics of inverter for charge pump
</p>  

Low pass filter suppress the higher frequency signal and passes signal to Voltage Controlled Os-
cillator(VCO) in order to match the output frequency of the system with input frequency. The
basic VCO is constructed using mosfet, Op-amp, resistors and capacitors in our case it is inverter like structure with power fets.

### 2.Theory - ic fab process

Complementary Symmetry MOS ICs (COS/MOS) involves both a p-channel and an n-channel MOSFET fabricated on the same chip.
Capacitors may be obtained by utilising the p-n junctions in transistor type structures or the MOS capacitive effects employing the silicon-dioxide layer. 

### 3.Theory - euler path
 Eulerian trail is a trail in a finite graph that visits every edge exactly once. Used to make layout compact and use less metals. 
 
## PRELAYOUT IMPLEMENTATION & SIMULATION
### 1. Setting up linux environment
Remotespark online linux environment with pre installed tools was used for simulations of On-chip-clock-multiplier-PLL-using-OSU-180nm-PDK.

![Screenshot (3307) width="100"](https://user-images.githubusercontent.com/46894129/137920499-9740a17f-a0fa-40fd-8c22-c6b295cd2662.png)
<p align="center">
    Fig.3.1. github repository download
</p>  

### 2. Phase detector
PFD compares the phase and frequency between input and output signal and produces the pulse. Width of the pulse depends on the 
phase difference between input and output signals.

![Screenshot (3313)](https://user-images.githubusercontent.com/46894129/137923187-50064596-5d88-434b-97d5-742a625e3b3f.png)
<p align="center">
    Fig.3.2. Phase detector terminal  
</p>  

![Screenshot (3314)](https://user-images.githubusercontent.com/46894129/137923951-5675c666-edcf-4b9c-b155-4e813be51782.png)
<p align="center">
    Fig.3.3. Phase detector simulation  
</p>  

### 2. Charge pump
The output of PFD further passed through the charge pump. The outputs of the PFD are connected to the switches. The current reference
is designed and connected to the switches of the charge pump. When the output of upper input is high switch 1 will be closed and when the output of the lower 
upper input is low switch 2 will be closed.The output of the charge pump is taken from the connection between the
two switches. The output of the charge pump is connected to the low psas filter(LPF). A basic
RC circuit is used as LPF. When the switch 1 is closed, capacitor present in the LPF charges
and when the switch 2 is closed, the capacitor discharges. Here the switches are nothing but inverter topology witj power fets which have large W/L.
This suppress the high frequency components of PFD and provides the DC level to the VCO.

![Screenshot (3324)](https://user-images.githubusercontent.com/46894129/137924894-8406fe00-ccf6-41f5-8db1-d8204913a268.png)
<p align="center">
    Fig.3.4. Phase detector with charge pump terminal
</p>  

![Screenshot (3325)](https://user-images.githubusercontent.com/46894129/137925523-cbb54956-ccdb-4822-b33f-a0447fcfe2e6.png)
<p align="center">
    Fig.3.5. Charge pump simulation without Low pass filter 
</p>  

![Screenshot (3323)](https://user-images.githubusercontent.com/46894129/137925909-dc3a3a84-0704-4f60-ab7a-20f3950b4b3c.png)
<p align="center">
    Fig.3.6. Charge pump simulation with Low pass filter 
</p>  


### 3. Voltage controlled oscillator
After PFD and Charge pump provides the DC level to the VCO.
The VCO produces the replicas of frequency and phase of the error signal generated by the phase
detector. The frequency of an oscillator is inversely proportional to the delay introduced by each
stage. It is therefore possible to navigate the frequency by controlling the amount of current
available at the charging and discharging load of each stage. Specifically this type of circuit is
known as the current starved VCO. There are certain assets of choosing this architecture over
the other VCOs, this architecture reduces the number of jitter produced at the output of PLL.

A delay element of stacked inverter-based ring oscillator comprises of three inverters stacked. 
This improves the delay in every single stage and enhances the gain of the each
block. A odd number of stacked inverters are cascaded to work as an oscillator. The output
voltage swing depends on charging and discharging of the current. In this design, the leakage
current is minimum. Thus it helps to increase the voltage swing and also reduces the power
consumption. Appreciable results can be achieved for a low supply voltage with this design.

![Screenshot (3368)](https://user-images.githubusercontent.com/46894129/137927119-2712b306-ead1-4a71-a4ea-f14ba0eaf783.png)
<p align="center">
    Fig.3.7. Voltage controlled oscillator terminal
</p>  

![Screenshot (3329)](https://user-images.githubusercontent.com/46894129/137927881-9bc0d4c6-30aa-4ad0-b312-ccfa5f6eca06.png)
<p align="center">
    Fig.3.8. Voltage controlled oscillator referance as 0.5
</p> 

![Screenshot (3330)](https://user-images.githubusercontent.com/46894129/137928256-2bbc2b4b-de21-46b6-9812-520f3632f0b1.png)
<p align="center">
    Fig.3.9. Voltage controlled oscillator referance as 0.6
</p> 

![Screenshot (3331)](https://user-images.githubusercontent.com/46894129/137928698-2f551828-e6e7-4952-a1e1-760a41e0ca7a.png)
<p align="center">
    Fig.3.10. Voltage controlled oscillator referance as 0.4
</p> 


### 4. Frequency divider
For frequency division, toggle mode generated usin D flip-flops. They are used in a chain as a divide by two counter. One flip-flop will divide the clock, Fin by 2, 
two flip-flops will divide Fin by 4 (and so on).
final output of whole feed back loop should be Fin/8 as it has to be compared to orignial input signal of the PLL.
![Screenshot (3336)](https://user-images.githubusercontent.com/46894129/137928919-a378612f-2cec-4118-8875-14bd524ec112.png)

<p align="center">
    Fig.3.11. Frequency division terminal
</p> 

![Screenshot (3335)](https://user-images.githubusercontent.com/46894129/137929077-6ec9add7-5ece-47b6-8fd3-1578af584a65.png)

<p align="center">
    Fig.3.12. Frequency division by 2 simulation 
</p> 

### 5. Phase lock loop
 The whole On-chip-clock-multiplier-PLL was simulated with integrating all the blocks with corner frequencies of 5Mhz,10Mhz,12.5Mhz.
 
![Screenshot (3338)](https://user-images.githubusercontent.com/46894129/137929298-6f7cae79-9b6c-455e-83bb-563fafeef605.png)
<p align="center">
    Fig.3.13. Phase lock loop terminal
</p> 

![Screenshot (3339)](https://user-images.githubusercontent.com/46894129/137929653-28994e28-3420-4c3e-8041-8db72670a43c.png)
<p align="center">
    Fig.3.14. Phase lock loop simulation with corner frequency 5Mhz
</p> 

![Screenshot (3342)](https://user-images.githubusercontent.com/46894129/137929794-1a0df920-ad06-475f-a766-279f9fc31386.png)
<p align="center">
    Fig.3.15. Phase lock loop simulation with corner frequency 10Mhz
</p> 

![Screenshot (3343)](https://user-images.githubusercontent.com/46894129/137929981-58798c9a-be3e-483f-8e3e-06ba9cac69ae.png)
<p align="center">
    Fig.3.16. Phase lock loop simulation with corner frequency 12.5Mhz
</p> 

![Screenshot (3344)](https://user-images.githubusercontent.com/46894129/137930222-4554b6ae-a663-4f5c-8eba-40417a93f215.png)
<p align="center">
    Fig.3.17. Phase lock loop check frequency increment simulation 
</p> 

## PHYSICAL DESIGN(PD) INTRODUCTION
The physcial design is done using magic tool where the netlist from circuit simulator is dumped. This magic file generated after post layout cannot
be simulated thus we convert it to spice model to geneate the mos, capacatance which is a readable format. After that we make some modification in 
spice file by adding active sources for post layout simulation.
The significance of Lambda rules were applied and shown.
<br />
![Screenshot (3401)](https://user-images.githubusercontent.com/46894129/137963512-e94a081b-947b-48f4-bf16-bb748c689559.png)
<p align="center">
    Fig.4.1. Inverter layout in magic tool
</p> 

![Screenshot (3402)](https://user-images.githubusercontent.com/46894129/137963549-8a25fd06-e9cf-4e72-980c-bb651139b230.png)
<p align="center">
    Fig.4.2. Extraction of files 
</p> 

![Screenshot (3403)](https://user-images.githubusercontent.com/46894129/137963598-e14d5029-c926-4786-8cbe-5fcf2e935472.png)
<p align="center">
    Fig.4.3. Extracted spice file need sources for post laypot simulation
</p> 


## PFD and VCO PD
Here the ngspice model are simulated and tested with respect to pre layout simulation as done previously
![Screenshot (3357)](https://user-images.githubusercontent.com/46894129/137958158-7b984ed7-68d6-4dd0-8c45-82e33bcbf115.png)
<p align="center">
    Fig.5.1. Phase detector and charge pump terminal 
</p> 

![Screenshot (3358)](https://user-images.githubusercontent.com/46894129/137958230-17835482-26cc-46d4-a2ad-74ce96d9064f.png)
<p align="center">
    Fig.5.2. Phase detector post layout simulation
</p> 

![Screenshot (3381)](https://user-images.githubusercontent.com/46894129/137957167-34d78d0a-ea8a-4bbd-bc77-f69df36ae22d.png)
<p align="center">
    Fig.5.3. Charge pump post layout simulation
</p> 

![Screenshot (3360)](https://user-images.githubusercontent.com/46894129/137958308-b6cd0c75-0b10-440f-ab07-c554cfc683c9.png)
<p align="center">
    Fig.5.4. Voltage controlled oscillator terminal 
</p> 

![Screenshot (3387)](https://user-images.githubusercontent.com/46894129/137959101-0dce22d3-8fd6-446f-801f-c22ae30dd562.png)
<p align="center">
    Fig.5.4. Voltage controlled oscillator with 0.5 as referance post layout simulation
</p> 

![Screenshot (3389)](https://user-images.githubusercontent.com/46894129/137959148-f351d1dd-a046-463b-b16e-4c674a26ffe7.png)
<p align="center">
    Fig.5.4. Voltage controlled oscillator with 0.6 as referance post layout simulation
</p> 


## FREQUENCY DIVIDER AND MUX PD
![Screenshot (3394)](https://user-images.githubusercontent.com/46894129/137961294-6891b5e8-08d5-4037-8cdb-34e18bfe45d1.png)
<p align="center">
    Fig.6.1. Frequency Divider terminal 
</p> 

![Screenshot (3395)](https://user-images.githubusercontent.com/46894129/137961403-85c0348a-bbe3-4754-936d-0f54e1f2f5ed.png)
<p align="center">
    Fig.6.2. Frequency Divider post layout simulation
</p> 


![Screenshot (3396)](https://user-images.githubusercontent.com/46894129/137961486-ab981d33-7907-468e-b31c-e568278b740a.png)
<p align="center">
    Fig.6.1. MUX terminal 
</p> 

![Screenshot (3397)](https://user-images.githubusercontent.com/46894129/137961577-aff27287-1c90-45c5-930b-c9db995b4157.png)
<p align="center">
    Fig.6.2. MUX post layout simulation
</p> 


## FINAL PLL LAYOUT AND CONCLUSION
### 1. Final PLL layout
The layout is converted to .sp file from .magic for post layout simulations.
Finally to conclude the specification were met with significantly matching post and pre layout simulation.
![Screenshot (3380)](https://user-images.githubusercontent.com/46894129/137957050-b7de1708-061d-4c5d-9529-46750e193eca.png)

<p align="center">
    Fig.7.1. Phase lock loop terminal
</p> 


![Screenshot (3383)](https://user-images.githubusercontent.com/46894129/137957319-a8262522-5fe0-482d-9214-46fe305301d8.png)

<p align="center">
    Fig.7.2. Final Phase lock loop post layout simulation
</p> 


![Screenshot (3382)](https://user-images.githubusercontent.com/46894129/137957248-5e2fc15e-2330-4018-b0f0-de01e2a057f4.png)
<p align="center">
    Fig.7.3. Final frequency count post layout simulation
</p> 


### 2. Conclusion 
The Charge Pump based Phase Locked Loop with frequency was designed for a
single core. The frequency range pertaining from Fclkin – 5MHz to 12Mhz, Fclkout – 40MHz to 100MHz at 1.8v was achieved
with a cascaded invertor topplogy based VCO, PFD and frequency divider blocks. The results with physical design implementation were
appreciable with minimum jitter at the output.

## APPLICATIONS LEARNED

The phase-locked loop is one of the basic blocks in modern electronic systems. It is generally
used in multimedia, communication and in many other applications.

- It is used in time to digital converters
- It is used for Jitter reduction, skew suppression, clock recovery.
- It is used in frequency shifting decodes for demodulation carrier frequencies.
- With respect to societal context, A stable on-chip PLL will help in keeping track of time
accurately. Working on on-chip applications provides better experience in solving real
world circuit based problems, rather than just designing a circuit for simulations. The
idea of designing a chip will encourage many institutes to come forward and provide better
learning to the students.

## AUTHOR

 * Sachin Dalabanjan
 
## ACKNOWLEDGEMENTS

  * Kunal Ghosh , Co-founder of VSD Corp.Pvt.ltd
  * Philipp Guhring , Software Architect at LibreSilicon Association
  * Paras Sanjay Gidd, VSD IP Research intern
  




 
